---
title: "Interactions 1"
subtitle: "Princeton University"
author: "Jason Geller, PH.D.(he/him)"
date: 'Updated:`r Sys.Date()`'
footer: "PSY 503: Foundations of Statistics in Psychology"
format: 
  revealjs:
    theme: blood
    css: slide-style.css
    multiplex: true
    transition: fade
    slide-number: true
    incremental: false 
    chalkboard: true
    fontsize: "25pt"
execute:
  freeze: auto
  echo: true
  message: false
  warning: false
  fig-align: center
  fig-width: 12
  fig-height: 8
  editor_options: 
  chunk_output_type: inline
  code-overflow: wrap
  html:
    code-fold: true
    code-tools: true
---

## Packages

```{r}
#| echo: true
#| 
library(pacman)
p_load("tidyverse", "easystats", "broom", "kableExtra", "interactions")
```

```{r}
library(grateful)
pkgs <- cite_packages(output = "table", out.dir = ".")

pkgs
```

# Today

-   Testing interactions/moderation analysis

    -   Categorical by Continuous
    -   Continuous by Continuous

## Interactions

```{r}
#| eval: false
#| 

lm(plant_growth ~ sun_exposure + water)

```

## Interactions

```{r}
#| eval: false
#| 

lm(plant_growth ~ sun_exposure +  water)

```

![](images/sun-water.bmp){fig-align="center"}

## Interactions

```{r, eval=FALSE}

lm(plant_growth ~ sun_exposure * water)
```

![](images/plant-sun.png){fig-align="center"}

## Interactions

```{r, eval=FALSE}

lm(plant_growth ~ sun_exposure * water)

```

![](images/sun-inter.png){fig-align="center"}

## What is a moderator?

![](images/moderation1.png){fig-align="center"}

## What is a moderator?

$$Y=b_{0}+b_{1}X_1+ b_2Z_2 + b_3X_1*Z_2 + e$$

-   A moderator variable Z is a variable that alters the strength of the
    relationship between X and Y

![](images/moderation2.png){fig-align="center"}

## What do interactions Look Like?

![](images/types-of-interaction-flat.png){fig-align="center"}

# Today's Dataset

-   Student evaluations for a sample of 463 courses taught by 94
    professors from the University of Texas at Austin

-   Six students rated the professors' physical appearance

```{r}
evals_agegend=read_csv("https://raw.githubusercontent.com/jgeller112/psy503-psych_stats/master/evals.csv")
evals1= evals_agegend %>%
dplyr::select(ID, score, age, gender)
```

```{r, echo=FALSE}
summary(evals)
```

## Research Question

-   Does Age and Sex (Males, Females) of the instructor influence
    instructor ratings?

    -   DV: Evals
    -   IV:
        -   Age
        -   Gender
        -   Age\*Gender Interaction

## Scatterplot

```{r}
#| fig-align: center

ggplot(evals1, aes(x = age, y = score, color = gender)) +
  geom_point() +
  labs(x = "Age", y = "Teaching Score", color = "Gender") +
  geom_smooth(method = "lm", se = FALSE)
```

## How to Conduct Moderation Analysis?

-   Moderation analysis can be conducted by adding one or multiple
    interaction terms in a regression analysis

Z is a moderator for the relation between X and Y, we can fit a
regression model

$$\begin{eqnarray*} 
Y & = & b_{0}+b_{1}*X+b_{2}*Z+b_{3}*X*Z+e \\ & = & \begin{cases} b_{0}+b_{1}*X+e & \mbox{For females}(Z=0)\\ b_{0}+b_{2}+(b_{1}+b_{3})*X+e & \mbox{For males}(Z=1) \end{cases} \end{eqnarray*}$$

-   When Z=0 (females),the effect of X on Y is $b_1+b_3âˆ—0=b_1$

-   When Z=1 (males), the effect of X on Y is $b_1 + b_3*(1)$

## Steps for moderation analysis

A moderation analysis typically consists of the following steps:

1.  Compute the interaction term XZ=X\*Z

2.  Fit a multiple regression model with X, Z, and X\*Z as predictors

3.  Test whether the regression coefficient for XZ (interaction) is
    significant

    1.  If so, interpret the moderation effect

4.  Display the moderation effect graphically

## Steps for moderation analysis

-   Compute the interaction term XZ=X\*Z

-   Center continuous variables

    -   Centering solves two problems:

        -   Interpretation

        -   Multicollinearity

```{r}
evals_interact <- evals1 %>%
  mutate(age_c=datawizard::center(age),gender_trt=ifelse(gender=="female", 0, 1), inter=age_c*gender_trt)
```

## Steps for moderation analysis

-   Fit a multiple regression model with X, Z, and XZ as predictors

```{r}
lm(evals_interact$score~age_c*gender_trt, data=evals_interact)  tidy(conf.int=TRUE) %>%
  knitr::kable() %>%
    kable_styling(font_size = 24)
```

## Steps for moderation analysis

-   Test whether the regression coefficient for X\*Z is significant

## Interpretations

$$\hat{Y}= b_0 + b_1 X + b_2 Z + b_3 X*Z$$

-   $b_0$: the intercept, or the predicted outcome when X = 0 and Z=0
-   $b_1$: the simple effect or slope of $X$, for a one unit change in
    $X$ the predicted change in $Y$ at $Z = 0$
-   $b_2$: The offset/difference in the intercept for a one unit change
    in $Z$ the predicted change in Y at X = 0 or at the mean
-   $b_3$: The interaction of $X$ and $Z$, the offset in slope for $Z$
    for a one-unit increase in $X$ (or vice versa)

## Interpretations

```{r}
lm(score~age_c*gender_trt, data=evals_interact) %>%
   tidy(conf.int=TRUE) %>%
  knitr::kable() %>%
    kable_styling(font_size = 24) %>%
 row_spec(1, color = "white",
              background = "red")
```


## Interpretations

```{r}
lm(score~age_c*gender_trt, data=evals_interact) %>%
   tidy(conf.int=TRUE) %>%
  knitr::kable() %>%
    kable_styling(font_size = 24) %>%
 row_spec(2, color = "white",
              background = "red")
```


## Interpretations

```{r}
lm(score~age_c*gender_trt, data=evals_interact) %>%
   tidy(conf.int=TRUE) %>%
  knitr::kable() %>%
    kable_styling(font_size = 24) %>%
 row_spec(3, color = "white",
              background = "red")
```

## Interpretations

```{r}
lm(score~age_c*gender_trt, data=evals_interact) %>%
   tidy(conf.int=TRUE) %>%
  knitr::kable() %>%
    kable_styling(font_size = 24) %>%
 row_spec(4, color = "white",
              background = "red")
```

## Moderation: simple slopes

-   If the interaction is significant, then you usually ignore the other
    individual effects (age and gender)

-   So what do I do if my interaction is significant?

    . . .

-   **A simple slope analysis**

## Steps for Moderation Analysis

-   Obtain simple slopes

    -   When a continuous independent variable interact with a
        moderating variable, its slope at a particular level of the
        moderating variable

    -   Test if slope $\neq$ 0

```{r}
#hello to our friend emmeans 
#library(emmeans)
d=lm(score~age_c*gender_trt, data=evals_interact)

emtrends(d, ~ gender_trt, var="age_c") #simple slopes
```

## Simple Slopes

```{r}
library(interactions)

sim_slopes(d, pred=age_c, modx=gender_trt)

```

## Steps for Moderation Analysis

-   Difference in slopes

    -   *Testing simple slopes is not the same thing as testing their
        difference*

```{r}
d=lm(score~age_c*gender_trt, data=evals_interact)

emtrends(d, pairwise ~ gender_trt, var="age_c")
```

## Interactions

-   You should only be following up interactions if significant!

![](images/gelman.png){fig-align="center"}

## Visualize Categorical by Continuous Interactions

```{r, fig.align='center', out.width="90%"}
ggplot(evals1, aes(x = age, y = score, color = gender)) +
  geom_point() +
  labs(x = "Age", y = "Teaching Score", color = "Gender") +
  geom_smooth(method = "lm", se = FALSE)

```

## Visualize Categorical by Continuous Interactions

-   Parallel slopes models still allow for different intercepts but force all lines to have the same slope

```{r, fig.align='center', out.width="80%"}
ggplot(evals1, aes(x = age, y = score, color = gender)) +
  geom_point() +
  labs(x = "Age", y = "Teaching Score", color = "Gender") +
  geom_parallel_slopes(se = FALSE)
```

## Parallel slopes

-   Model Comparisons

    - Test model without interaction to model with interaction

```{r}

# no inter
main<-lm(score~age_c + gender_trt, data=evals_interact) 

# inter
inter<- lm(score~age_c*gender_trt, data=evals_interact)

anova(main, inter)
```

## Parallel Slopes

::: columns
::: {.column width="50%"}
```{r}
#| fig-align: center
#| 

ggplot(evals_interact, aes(x = age, y = score, color = gender)) +
  geom_point() +
  labs(x = "Age", y = "Teaching Score", color = "Gender") +
  geom_smooth(method = "lm", se = FALSE)
```
:::

::: {.column width="50%"}
```{r}
#| fig-align: center
#| 

ggplot(evals_interact, aes(x = age, y = score, color = gender)) +
  geom_point() +
  labs(x = "Age", y = "Teaching Score", color = "Gender") +
  geom_parallel_slopes(se = FALSE)

```
:::
:::

# Continuous x Continuous Interactions

## Continuous x Continuous Interactions

-   Do violent video games make people aggressive?

    -   DV: Aggression

    -   IV:

        -   Callous unemotional traits
        -   Number of hours spent playing video games per week
        -   Callous unemotional traits\*Number of hours spent playing
            video games per week

-   If callous-unemotional traits were a moderator then we're saying
    that the strength or direction of the relationship between game
    playing and aggression depends on the strength of
    callous-unemotional traits

```{r}
# grab dataset from link
moderation_vio=read_csv("https://raw.githubusercontent.com/jgeller112/psy503-psych_stats/master/moderation.csv")
```

## Continuous x Continuous Interactions

-   Centering

    -   Can reduce multicollinearity

    -   This is because if $X*Z$ creates a line, it means you have added
        a new predictor (XZ) that strongly correlates with X and Z

```{r}
library(datawizard)
# centering vars
moderation_vio <- moderation_vio %>%
  mutate(vid_games_c=center(Vid_Games), caunts_c=center(CaUnTs))

```

## Continuous x Continuous Regression

```{r}
lm(Aggression~ vid_games_c*caunts_c,  data=moderation_vio)  %>% 
  tidy(conf.int=TRUE) %>%
  knitr::kable() %>%
    kable_styling(font_size = 24) %>%
 row_spec(2, color = "white",
              background = "red")
  
```

???

(Intercept): the intercept, or the predicted outcome when hours = 0 and
traits = 0. hours: the slope of Hours, for a one unit change in Hours,
the predicted change in weight loss at Effort=0. triat: the slope of
trait, for a one unit change in vio the predicted change in trait at
Hours=0. hours:effort: the interaction of Hours and Effort, the change
in the slope of HRS for every one unit increase in CALLOUSNESS (or vice
versa).

## Interpretation Continuous x Continuous Interactions

-   $b_0$: the intercept, or the predicted outcome when X = 0 and Z=0
-   $b_1$: the simple effect or slope of $X$, for a one unit change in
    $X$ the predicted change in $Y$ at $Z = 0$
-   $b_2$: The simple effect or slope of $Z$, for a one unit change in
    $Z$ the predicted change in Y at X = 0
-   $b_3$:The interaction of $X$ and $Z$, the change in the slope of $X$
    for a one-unit increase in $Z$ (or vice versa)

```{r, echo=FALSE}
lm(Aggression~ vid_games_c*caunts_c,  data=moderation_vio) %>%
  tidy(conf.int=TRUE) %>%
  knitr::kable() %>%
    kable_styling(font_size = 24) %>%
 row_spec(2, color = "white",
              background = "red")
```

## Continuous X Continuous Interactions

-   If the Z (moderator variable) was categorical, you would be checking
    if separate groups (levels) have different slopes for the
    non-categorical variable

-   However, we cant do that with continuous x continuous interactions

## Decomposing Continuous X Continuous Interactions: Spotlight Analysis

-   For continuous moderator variables, you "create" low, average, and
    high groups

    -   Low groups are people who are one SD below the mean

    -   Average groups are people are at the mean

    -   High groups are people who are one SD above the mean
        31b8e172-b470-440e-83d8-e6b185028602:dAB5AHAAZQA6AFoAUQBBAHgAQQBEAGcAQQBNAFEAQQA1AEEARABZAEEATQBBAEEAMQBBAEMAMABBAE0AQQBCAGgAQQBHAE0AQQBaAEEAQQB0AEEARABRAEEAWgBnAEIAaABBAEcAVQBBAEwAUQBBADQAQQBHAEkAQQBPAFEAQQA1AEEAQwAwAEEATwBRAEIAagBBAEQARQBBAFkAZwBBADMAQQBHAEkAQQBaAEEAQQAzAEEARwBNAEEATQBBAEIAbQBBAEQARQBBAAoAcABvAHMAaQB0AGkAbwBuADoATQBRAEEAdwBBAEQAVQBBAE0AUQBBADAAQQBBAD0APQAKAHAAcgBlAGYAaQB4ADoACgBzAG8AdQByAGMAZQA6AEwAUQBBAHQAQQBDADAAQQBDAGcAQQBqAEEAQwBBAEEAVABRAEIAdgBBAEcAUQBBAFoAUQBCAHkAQQBHAEUAQQBkAEEAQgBwAEEARwA4AEEAYgBnAEEANgBBAEMAQQBBAFUAdwBCAHAAQQBHADAAQQBjAEEAQgBzAEEARwBVAEEASQBBAEIAVABBAEcAdwBBAGIAdwBCAHcAQQBHAFUAQQBjAHcAQQBLAEEAQQBvAEEATABRAEEAZwBBAEYAYwBBAFoAUQBBAGcAQQBHAEUAQQBjAGcAQgBsAEEAQwBBAEEAWgBRAEIANABBAEcARQBBAGIAUQBCAHAAQQBHADQAQQBhAFEAQgB1AEEARwBjAEEASQBBAEIAMABBAEcAZwBBAFoAUQBBAGcAQQBHAGsAQQBiAGcAQgAwAEEARwBVAEEAYwBnAEIAaABBAEcATQBBAGQAQQBCAHAAQQBHADgAQQBiAGcAQQBnAEEARwBJAEEAWgBRAEIAMABBAEgAYwBBAFoAUQBCAGwAQQBHADQAQQBJAEEAQgBvAEEARwA4AEEAZABRAEIAeQBBAEgATQBBAEkAQQBCAHYAQQBHAFkAQQBJAEEAQgAyAEEARwBrAEEAWgBBAEIAbABBAEcAOABBAEkAQQBCAG4AQQBHAEUAQQBiAFEAQgBsAEEASABNAEEASQBBAEIAaABBAEcANABBAFoAQQBBAGcAQQBIAFUAQQBiAGcAQgBsAEEARwAwAEEAYgB3AEIAMABBAEcAawBBAGIAdwBCAHUAQQBHAEUAQQBiAEEAQQBnAEEASABRAEEAYwBnAEIAaABBAEcAawBBAGQAQQBCAHoAQQBDAEEAQQBkAEEAQgB2AEEAQwBBAEEAYwBBAEIAeQBBAEcAVQBBAFoAQQBCAHAAQQBHAE0AQQBkAEEAQQBnAEEARwBFAEEAWgB3AEIAbgBBAEgASQBBAFoAUQBCAHoAQQBIAE0AQQBhAFEAQgB2AEEARwA0AEEAQwBnAEEASwBBAEMAMABBAEkAQQBCAFUAQQBHAGcAQQBhAFEAQgB1AEEARwBzAEEASQBBAEIAaABBAEcASQBBAGIAdwBCADEAQQBIAFEAQQBJAEEAQgAzAEEARwBnAEEAYQBRAEIAagBBAEcAZwBBAEkAQQBCADIAQQBHAEUAQQBjAGcAQgBwAEEARwBFAEEAWQBnAEIAcwBBAEcAVQBBAEkAQQBCADUAQQBHADgAQQBkAFEAQQBnAEEASABjAEEAWQBRAEIAdQBBAEgAUQBBAEkAQQBCADAAQQBHADgAQQBJAEEAQgByAEEARwA0AEEAYgB3AEIAMwBBAEMAQQBBAGQAQQBCAG8AQQBHAFUAQQBJAEEAQgBrAEEARwBrAEEAWgBnAEIAbQBBAEcAVQBBAGMAZwBCAGwAQQBHADQAQQBZAHcAQgBsAEEASABNAEEASQBBAEIAcABBAEcANABBAEkAQQBBAG8AQQBHAGsAQQBMAGcAQgBsAEEAQwA0AEEATABBAEEAZwBBAEcAdwBBAGIAdwBCADMAQQBDAHcAQQBJAEEAQgBoAEEASABZAEEAWgBRAEIAeQBBAEcARQBBAFoAdwBCAGwAQQBDAHcAQQBJAEEAQgBvAEEARwBrAEEAWgB3AEIAbwBBAEMAawBBAEMAZwBBAEsAQQBDADAAQQBJAEEAQgBUAEEARwA4AEEASQBBAEIAaABBAEgAUQBBAEkAQQBCAGsAQQBHAGsAQQBaAGcAQgBtAEEARwBVAEEAYwBnAEIAbABBAEcANABBAGQAQQBBAGcAQQBHAHcAQQBaAFEAQgAyAEEARwBVAEEAYgBBAEIAegBBAEMAQQBBAGIAdwBCAG0AQQBDAEEAQQBZAHcAQgBoAEEARwB3AEEAYgBBAEIAdgBBAEgAVQBBAGMAdwBCAHUAQQBHAFUAQQBjAHcAQgB6AEEAQwB3AEEASQBBAEIAMwBBAEcAVQBBAEkAQQBCADMAQQBHAEUAQQBiAGcAQgAwAEEAQwBBAEEAZABBAEIAdgBBAEMAQQBBAFoAUQBCADQAQQBHAEUAQQBiAFEAQgBwAEEARwA0AEEAWgBRAEEAZwBBAEgAUQBBAGEAQQBCAGwAQQBDAEEAQQBjAGcAQgBsAEEARwB3AEEAWQBRAEIAMABBAEcAawBBAGIAdwBCAHUAQQBIAE0AQQBhAEEAQgBwAEEASABBAEEASQBBAEIAaQBBAEcAVQBBAGQAQQBCADMAQQBHAFUAQQBaAFEAQgB1AEEAQwBBAEEAYQBBAEIAdgBBAEgAVQBBAGMAZwBCAHoAQQBDAEEAQQBiAHcAQgBtAEEAQwBBAEEAZABnAEIAcABBAEcAUQBBAFoAUQBCAHYAQQBDAEEAQQBaAHcAQgBoAEEARwAwAEEAWgBRAEEAZwBBAEgAQQBBAGIAQQBCAGgAQQBIAGsAQQBJAEEAQgBoAEEARwA0AEEAWgBBAEEAZwBBAEcARQBBAFoAdwBCAG4AQQBIAEkAQQBaAFEAQgB6AEEASABNAEEAYQBRAEIAdgBBAEcANABBAEMAZwBBAHQAQQBDADAAQQBMAFEAQQA9AAoAcwB1AGYAZgBpAHgAOgA=:31b8e172-b470-440e-83d8-e6b185028602

# Probing Interactions: Spotlight Analysis

-   Low/below mean created by *SUBTRACTING* 1 SD

-   High/above mean created by *ADDING* 1 SD

-   The rule is that we have to bring them to the middle because we
    centered so that zero is the middle

```{r}
#create the low and high z score variables 
a <- mean(moderation_vio$caunts_c) + sd(moderation_vio$caunts_c)

at <- mean(moderation_vio$caunts_c)

b <- mean(moderation_vio$caunts_c) - sd(moderation_vio$caunts_c)

```

------------------------------------------------------------------------

## Spotlight Analysis

```{r}

# create a list for values at a, b, and mean and round them
mylist <- list(caunts_c=c(round(b, 1), round(at,1), round(a, 1)))

# run lm again
d=lm(Aggression~vid_games_c*caunts_c,data=moderation_vio)

# get simple slopes at each level at b a
emtrends(d,~caunts_c, var="vid_games_c", at=mylist)

```

. . .

-   At high levels of callousness, the strength of hours of video games
    predicting aggression is the strongest, b = 0.43

## Probing Interactions: Simplier Way

-   Use `interact_plot` from the `interactions`

```{r, fig.align='center', out.width="80%"}
library(interactions)

interact_plot(d, pred = vid_games_c, modx = caunts_c, interval = TRUE, plot.points = TRUE)

```

## Probing Interactions: Johnson-Neyman Plot

-   Is a floodlight analysis on the whole range of the moderator

-   Provides an interval (2 points) where the slope of a predictor is
    not statistically significant across different values of the
    mediator

```{r}
library(interactions)
johnson_neyman(model = d, pred = vid_games_c,
  modx = caunts_c, control.fdr = TRUE) # important bc otherwise does not correct for multiple comparisons

```

```{r, echo=FALSE, fig.align='center', out.width="100%", warning=FALSE, message=FALSE, fig.align='center'}

knitr::include_graphics("JNplot.png")
```

## Moderation: MeMoBootR

-   We can use the `MeMoBootR` to complete the entire processing,
    including data screening for us!

-   You would enter the raw variables, as the centering is completed for
    you

```{r}
#devtools::install_github("doomlab/MeMoBootR")
library(MeMoBootR)
mod_model <- moderation1(y = "Aggression",
                         x = "Vid_Games",
                         m = "CaUnTs",
                         df = moderation_vio)
```

## Moderation: MeMoBootR

```{r}
#data screenin
#mod_model$datascreening$fulldata
#models
#summary(mod_model$model1)
#mod_model$interpretation
#graphs
#mod_model$graphslopes
```
