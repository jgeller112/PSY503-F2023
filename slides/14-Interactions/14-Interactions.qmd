---
title: "Interactions 2"
subtitle: "Princeton University"
author: "Jason Geller, PH.D.(he/him)"
date: 'Updated:`r Sys.Date()`'
footer: "PSY 503: Foundations of Statistics in Psychology"
format: 
  revealjs:
    theme: blood
    css: slide-style.css
    multiplex: true
    transition: fade
    slide-number: true
    incremental: false 
    chalkboard: true
    fontsize: "25pt"
webr:
  packages: ["tidyverse", "easystats", "broom", "kableExtra", "interactions", "emmeans", "moderndive", "ggpredict", "pacman", "WebPower"]
filters:
  - webr
execute:
  freeze: auto
  echo: true
  message: false
  warning: false
  fig-align: center
  fig-width: 12
  fig-height: 8
  editor_options: 
  chunk_output_type: inline
  code-overflow: wrap
  html:
    code-fold: true
    code-tools: true
---

```{r}
#| echo: true
#| 
library(pacman)
p_load("tidyverse", "easystats", "broom", "kableExtra", "emmeans")

```

#Categorical x Categorical Interaction

## 2 x 2 Between Factorial Dataset

- LaPaglia, Miller, and Protexter (2022)

  - Looked at the impact of instructor fluency and gender on test performance (Quiz)
  
  - *N* = 72 (49 females, 23 males)
  
  - 2 (Fluency: fluent, disfluent) x 2 (Gender: male, female) design

```{r}
gen<- read_csv("https://raw.githubusercontent.com/jgeller112/psy503-psych_stats/master/static/slides/13_Interactions/in_gen_2x2.csv")

gen <- gen %>%
  mutate(Gender=as.factor(Gender), Fluency=as.factor(Fluency))
```

## Categorical x Categorical Interaction

- Factorial design (ANOVA)

  - Commonly used to refer to experiments where more than one factor is manipulated

  - 2-way (most common), 3-way factorial designs, 4-way... 

## 2-way (Factorial) ANOVA

- In the example above we have two factors:

  - Factor A (e.g., Gender) with 2 levels (e.g., male vs. female)
  - Factor B (e.g., Fluency) with 2 levels (e.g., Disfluency vs. Fluency)

- Fully crossed design

  - Every level of factor A is tested with every level of factor B
  - Total # groups (cells) is a x b

- We will see how to formulate in terms of model comparisons:

  - Main effect of A
  - Main effect of B
  - Interaction effect A x B

## Main Effects vs. Simple Effects

- What is a main effect?
  
  - The marginal mean differences correspond to main effects. They tell us what impact a particular factor has, ignoring the impact of the other factor.

```{r}
#| echo: false
#| 
mean.summary = gen %>%
  drop_na(.) %>%
  group_by(Gender, Fluency) %>%
  summarize(Quiz = mean(Quiz)) %>%
  pivot_wider(names_from = "Fluency",values_from = "Quiz" )

mean.summary$Gender = as.character(mean.summary$Gender)
mean.summary$Marginal = rowMeans(mean.summary[2:3])
mean.summary[3,1] = "Marginal"
mean.summary[3,2:4] = as.list(colMeans(mean.summary[2:4], na.rm=T))

kable(mean.summary, digits = 2) %>% 
  kable_styling() %>% 
  group_rows(start_row = 1, end_row = 3) %>%
  row_spec(3, bold = T, color = "white", background = "#562457")


```

- Regardless of Gender  condition, does Fluency  of instrutor affect performance?

## Main Effects vs. Simple Effects

- Regardless of Fluency  condition, does Gender of instrutor affect performance?

```{r}
#| echo: false
#| 
mean.summary = gen %>%
  drop_na(.) %>%
  group_by(Gender, Fluency) %>%
  summarize(Quiz = mean(Quiz)) %>%
  pivot_wider(names_from = "Fluency",values_from = "Quiz" )

mean.summary$Gender = as.character(mean.summary$Gender)
mean.summary$Marginal = rowMeans(mean.summary[2:3])
mean.summary[3,1] = "Marginal"
mean.summary[3,2:4] = as.list(colMeans(mean.summary[2:4], na.rm=T))

kable(mean.summary, digits = 2) %>% 
  kable_styling() %>% 
  group_rows(start_row = 1, end_row = 3) %>% 
  column_spec(4, bold = T, color = "white", background = "#562457")

```

## Main Effects vs. Simple Effects

- Simple effects

  - Are the marginal mean differences for Gender condition a good representation of what is happening within each of the Fluency conditions?

  - If not, interaction! 


```{r}
#| echo: false
#| 
kable(mean.summary, digits = 2) %>% 
  kable_styling() %>% 
  group_rows(start_row = 1, end_row = 3) %>%
  column_spec(2, background = "purple") %>%
  column_spec(3, background = "red") %>%
  column_spec(4, background = "blue") %>%
  row_spec(3, background = "green")

```

## Linear Modeling Approach: Treatment/Dummy Coding

- Testing the simple (conditional effects), not main effects

```{r, echo=FALSE}

tibble::tribble(
     ~Gender, ~Fluency, ~D1, ~D2, ~Interaction,
  "Female=0",     "Disfluent=0",  0L,  0L,           0L,
  "Female=0",  "Fluent=1",  0L,  1L,           0L,
    "Male=1",     "Disfluent=0",  1L,  0L,           0L,
    "Male=1",  "Fluent=1",  1L,  1L,           1L
  )

```

# Full Model

$$Y_{ijk} = \mu + \alpha_j + \beta_k + (\alpha* \beta)_{ijk}$$

- $Y_{ijk}$: is an individual score in the jth level of factor A and the kth level of factor B (i
indexes subjects within each (j,k) cell)

-  $µ$: is the overall mean of all cells
- $α_j$: is the effect of the jth level of factor A
- $β_k$: is the effect of the kth level of factor B
- $(α · β)_{jk}$: is the interaction effect of level j of A and level k of B

## ANOVA approach

- Two-Factor (A x B) design: 3 null hypotheses to be tested:

  - Main effect of A
  - Main effect of B
  - Interaction effect of A x B
  
- We will formulate a separate restricted model for each hypothesis test

$$F = \frac{SS_{R}-SS_{F}/{df_{R}-df_{F}} (p-1)}{SS_{F}/df_F(N-p)} = \frac{MS_{model}}{MS_{error}}$$

## Null Hypotheses

- The two main effects and the interaction represent three independent questions we can ask about the data. We have three null hypotheses to test.

- One null hypothesis refers to the marginal row means.

| | Disfluent  | Fluent  |  Marginal |
|:-|:-:|:-:|:-:|:-:|
| F |             $\mu_{11}$ | $\mu_{12}$  | $\mu_{1.}$ |
| M  |   $\mu_{21}$ | $\mu_{22}$ | $\mu_{2.}$ |
| Marginal | $\mu_{.1}$ | $\mu_{.2}$  | $\mu_{..}$ |

##  Null Hypotheses

| | Disfluent  | Fluent  |  Marginal |
|:-|:-:|:-:|:-:|:-:|
| F |             $\mu_{11}$ | $\mu_{12}$  | $\mu_{1.}$ |
| M  |   $\mu_{21}$ | $\mu_{22}$ | $\mu_{2.}$ |
| Marginal | $\mu_{.1}$ | $\mu_{.2}$  | $\mu_{..}$ |

$$
\begin{aligned}
 H_0&: \mu_{1.} = \mu_{2.} = \dots = \mu_{R.}\\
H_1&: \text{Not true that }\mu_{1.} = \mu_{2.} = \dots = \mu_{R.}
\end{aligned}
$$
## Null Hypotheses

| | Disfluent  | Fluent  |  Marginal |
|:-|:-:|:-:|:-:|:-:|
| F |             $\mu_{11}$ | $\mu_{12}$  | $\mu_{1.}$ |
| M  |   $\mu_{21}$ | $\mu_{22}$ | $\mu_{2.}$ |
| Marginal | $\mu_{.1}$ | $\mu_{.2}$  | $\mu_{..}$ |


$$
\begin{aligned}
 \alpha_r&= \mu_{r.} - \mu_{..} \\
 H_0&: \alpha_1 = \alpha_2 = \dots = \alpha_R = 0\\
H_1&: \text{At least one }\alpha_r \neq 0
\end{aligned}
$$

## Null Hypotheses

- Main effect of Fluency


| | Disfluent  | Fluent  |  Marginal |
|:-|:-:|:-:|:-:|:-:|
| F |             $\mu_{11}$ | $\mu_{12}$  | $\mu_{1.}$ |
| M  |   $\mu_{21}$ | $\mu_{22}$ | $\mu_{2.}$ |
| Marginal | $\mu_{.1}$ | $\mu_{.2}$  | $\mu_{..}$ |


$$
\begin{aligned}
 \beta_c&= \mu_{.c} - \mu_{..} \\
 H_0&: \beta_1 = \beta_2 = \dots = \beta_C = 0\\
H_1&: \text{At least one }\beta_c \neq 0
\end{aligned}
$$

## Null Hypotheses


The interaction null hypothesis can then be stated as follows:

$$
\begin{aligned}
 (\alpha\beta)_{rc}&= \mu_{rc} - \alpha_r - \beta_c  - \mu_{..} \\
 H_0&: (\alpha\beta)_{11} = (\alpha\beta)_{12} = \dots = (\alpha\beta)_{RC} = 0\\
H_1&: \text{At least one }(\alpha\beta)_{rc} \neq 0
\end{aligned}
$$
