---
title: "Crash Course in R"
subtitle: "Princeton University"
author: "Jason Geller, PH.D."
date: 'Updated:`r Sys.Date()`'
footer: "PSY 503: Foundations of Statistics in Psychology"
format: 
  revealjs:
    theme: psy504.css
    multiplex: true
    transition: fade
    slide-number: true
    incremental: false 
    chalkboard: true

execute:
  freeze: auto
  echo: true
  message: false
  warning: false
  fig-align: center
  fig-width: 12
  fig-height: 8
  editor_options: 
  chunk_output_type: inline
  code-overflow: wrap
  html:
    code-fold: true
    code-tools: true
---

## Packages

```{r}
#| echo: false
#| 
library(tidyverse)
library(titanic)
library(gt)
library(grateful)



```

```{r}
#| echo: false
#| 
pkgs <- cite_packages(output = "table", out.dir = ".")
knitr::kable(pkgs)


```

## Objective

::: columns
::: {.column width="50%"}
-   Get you started with R

-   Load data in R

-   Explain some basic terminology and concepts

-   Learn how to run commands and save scripts

-   Manipulate data
:::
:::

```{r}
#| fig.align = "center",
#| echo = FALSE,
#| warning = FALSE,
#| out.width = "30%"

knitr::include_graphics("lover.png")
```

## It's scary

```{r}
#| fig.align = "center",
#| echo = FALSE,
#| warning = FALSE,
#| out.width = "65%"

knitr::include_graphics("nocluedog.png")
```

## Note

-   You can learn R!

-   You will get frustrated.

-   You will get errors that don't help or make sense.

    -   Google is your friend.
        -   Try Googling the specific error message first
        -   Then try googling your specific function and the error
        -   Try a bunch of different search terms.
    -   ChatGPT (use wisely)

# Outline

-   `Why R`

-   IDE

-   R commands, data structures, and functions

    -   Tidyverse & the Pipe Operator

    -   Multiple Functions

-   Reading in data

-   Manipulating data

-   Saving R scripts

## Why R?

::: columns
::: {.column width="50%"}
-   Free and open-source
-   Flexibility
-   Programming language (not point-and-click)
-   Excellent graphics (via `ggplot2`)
:::

::: {.column width="50%"}
-   Easy to generate reproducible reports (markdown and quarto)
-   Easy to integrate with other tools and programs
-   Inclusive community
-   Marketability
:::
:::

# Outline

-   Why R?

-   *`IDE`*

-   R commands, data structures, and functions

-   Tidyverse & the pipe operator

-   Multiple functions

-   Reading in data

-   Saving R scripts

## RStudio IDE

![](https://bookdown.org/ndphillips/YaRrr/images/RStudio_Screenshot_Labels.png){fig-align="center"}

## RStudio IDE

-   Make it your own!

![](https://i0.wp.com/cdn.r-bar.net/PID1174/SuperDarkMode.jpg?zoom=2&w=578&ssl=1){fig-align="center"}

# Outline

-   Why R?

-   RStudio

-   *`R commands, data structures, and functions`*

-   Tidyverse & the pipe operator

-   Multiple functions

-   Reading in data

-   Saving R scripts

## Commands

-   Commands are the code that you tell R to do for you

-   They can be very simple or complex

-   Computers do what *you* tell them to do. Mistakes happen!

    -   Maybe it's a typo, maybe it's a misunderstanding of what the
        code does

-   You can type a command directly into the *console*

-   You can type in a document (*Script* or *Markdown/Quarto*) and tell
    it to then run in the *console*

```{r}
X <- 4
```

## Commands

-   `>` indicates the console is ready for more code

-   `+` indicates that you haven't finished a code block

-   Capitalization and symbols matter

-   Hit the up arrow -- you can scroll through the last commands that
    were run

-   Hit the tab key -- you'll get a list of variable names and options
    to select from

-   Use the `?` followed by a command to learn more about it

## Comments

::: columns
::: {.column width="50%"}
![](https://www.explainxkcd.com/wiki/images/3/3b/future_self.png){fig-align="center"}
:::

::: {.column width="50%"}
-   You can make comments on your code using the `#` symbol

-   Comments are not processed by R, they provide documentation of your
    code for humans

-   Feel free to comment your personal code as much as you need to in
    order to understand it

-   Try to make your code clear enough that it can be understood even
    without comments
:::
:::

```{r}
#this does something
#this does not work because I am stupid
x=4 #assign 4 to x 

```

## Assignment

-   A variable is a symbol or object that stands for another value (just
    like "X" in algebra)

```{r}

x <- 4

x

```

-   The arrow `<-` is called an ASSIGNMENT OPERATOR, and tells R to save
    an object called x that has the value of 4. This is similar to
    saving a value in a graphing calculator

-   Can use `=` if you want

## Objects and values

-   We will use the terms **object** and **variable** a lot when talking
    about code in this class

-   `Objects` are things you save in your environment (like a set of
    numbers, a dataset, or a regression model)

-   `Variable` refers to columns of a data frame and to data variables
    that we use in models

## Vectors

-   Think of it as a row or column in a spreadsheet

-   Allows same classes to be concatenated together

    -   Numeric

```{r}

x <-  c(2,6,16)

x

```

## Vectors

-   Character

```{r}
x <- c("cat", "bat")

gender <- c("male", "female")
```

-   factors

```{r}

gender <- as.factor(gender)

gender

```

-   Logical

```{r}

x==7

```

## Indexing

-   Vectors can be indexed

    -   1 not 0 (ðŸ‘€ Python)

```{r}
x=c(1,2,3,4)
x[1] # ret first
x[-2] # everything but that number
x[1] <- 7 # Change values in vector
x
```

## Lists

::: columns
::: {.column width="50%"}
-   While vectors are one row of data, we might want to have multiple
    rows or types

-   With a vector, it is *key* to understand they have to be all the
    same type

-   Lists are a grouping of variables that can be multiple types
    (between list items) and *can be different lengths*

-   Often function output is saved as a list for this reason

-   They usually have names to help you print out just a small part of
    the list
:::

::: {.column width="50%"}
```{r}

library(palmerpenguins)

output <- lm(flipper_length_mm ~ bill_length_mm, data = penguins)
str(output)
```
:::
:::

## R as a calculator

-   Typing in a simple calculation show us the result

```{r}
608+ 28

```

```{r}
11527-283

```

```{r}
# divison
400/65
#multiplication
2*4
#exponentiation
5^2
```

## Functions

-   Take an object, do something to it, and return the result

-   More complex calculations can be done with functions:

    -   What is square root of 64?

```{r}
# sqrt function
# in parenthesis: what we want to perform function on
sqrt(64)
```

```{r}
#| eval = FALSE

sr=function(a, b){
  c=a + b
  return(c)
}

sr(2,3)
```

## Arguments

-   Some functions have settings ("arguments") that we can adjust:

-   `round(3.14)`

    -   Rounds off to the nearest integer (zero decimal places)

-   `round(3.14, digits=1)`

    -   One decimal place

## Getting Help

1.  Help files

```{r}
#| fig.align = "center",
#| echo = FALSE,
#| warning = FALSE,
#| out.width = "100%"

knitr::include_graphics("help.png")
```

## Exercise

1.  Open a blank new script

    1.1 File -\> New File \> R Script

    1.2 Ctrl + Shift + N

    1.3 Click on new script icon

2.  To paste strings together you can use the `paste`() function (e.g.,
    paste("Hello", "World")). Use ?paste or Google "paste function in R"
    to get an idea of how to use this function.

    2.1 Use the `paste` function to string together a sentence of your
    choice. Assign it to a variable or object.

3.  Modify the function below and instead of returning the sum, return
    the mean

    ```{r}
    mean=function(a, b){
      c=a + b
      return(c)
    }

    ```

# Outline

-   Why R

-   IDE

-   R commands & functions

    -   `Tidyverse & the Pipe Operator`

-   Multiple Functions

-   Reading in data

-   Saving R scripts

## Tidyverse and pipes

-   The `tidyverse` is an ecosystem of R packages designed for data
    science. All packages share an underlying design philosophy,
    grammar, and data structures.

```{r}
#| fig.align = "center",
#| echo = FALSE,
#| warning = FALSE,
#| out.width = "40%"

knitr::include_graphics("hex.png")
```

## Installing Tidyverse

```{r}
#| fig.align = "center",
#| echo = FALSE,
#| warning = FALSE,
#| out.width = "40%"

knitr::include_graphics("cran.png")
```

```{r}
#| eval = FALSE

install.packages(tidyverse)
```

-   Load package

```{r}

library(tidyverse)

```

## Pipes

-   `tidyverse` provides another interface to functions

    -   the pipe operator

        -   Makes code easier to read and follow:

-   This:

```{r}
#| eval = FALSE

a %>% 
  round()
```

-   Can be converted into:

    -   Start with a and then round

-   `|>` pipe is slowly becoming more popular

# Outline

-   Why R

-   IDE

-   R commands & functions

    -   Tidyverse & the Pipe Operator

-   `Multiple Functions`

-   Reading in data

-   Saving R scripts

## Multiple functions

-   Pipe operator makes it easy to do multiple functions in a row

```{r}
#| eval: false

16 %>% 
  sqrt() %>%
  abs()

16 |> 
  sqrt() |>
  abs()

```

-   What is this doing?

# Outline

-   Why R

-   IDE

-   R commands & functions

    -   Tidyverse & the pipe operator

-   Multiple functions

-   `Reading in data`

-   Saving R scripts

## Reading in data

-   Download the file

```{r}
#| echo = FALSE,
#| warning = FALSE,
#| out.width = "100%"

knitr::include_graphics("readr.png")
```

-   General form: `dataframe.name <-read_csv('filename')`

## Data frames

> A data frame is like an Excel spreadsheet. It is two-dimensional with
> rows and columns.

::: columns
::: {.column width="50%"}
-   Instead of creating a number of vectors we store all the vectors
    into a single DF

-   Can store numeric data (phone number, postal code, coordinates,
    etc.), float data (internet IP address, etc.), logical data (wants
    to receive ads: FALSE/TRUE, etc.), etc
:::

::: {.column width="50%"}
```{r}


car_model <- c("Ford Fusion", "Hyundai Accent", "Toyota Corolla")
car_price <- c(25000, 16000, 18000)
car_mileage <- c(27, 36, 32)

cars_df <- data.frame(model=car_model, price=car_price, mileage=car_mileage)

cars_df %>%
  knitr::kable()



```
:::
:::

## Reading other file types

-   Excel

```{r}
#| eval = FALSE

library(readxl)

fac<-  read_excel('/Users/jg/Desktop/experiment.xlsx', sheet=2)
# excel files can have multiple sheets
```

-   SPSS

```{r}
#| eval = FALSE

library(haven)

fac<-  read_spss('/Users/jg/Desktop/experiment.spss')

```

## Tibbles

-   Modern take on data frames

    -   Tidy data!

        -   Each variable forms a column

        -   Each observation forms a row

        -   Each cell is a single measurement

## Tibbles

::: columns
::: {.column width="50%"}
-   Never changes input's type
-   Never adjusts the names of variables
-   It evaluates arguments lazily and sequentially
:::

::: {.column width="50%"}
-   Differences

    -   Printing
:::

## 
:::

## Matrices

-   Matrices are vectors with dimensions (like a 2X3)

-   All the data *must be the same type*

```{r}
myMatrix <- matrix(data = 1:10,
                   nrow = 5,
                   ncol = 2)
myMatrix
```

## Working directories

::: columns
::: {.column width="50%"}
![](images/here.PNG){fig-align="center"}
:::

::: {.column width="50%"}
-   `Here` package

    -   `Here` helps set relative as opposed to absolute paths

        -   Why would this be a problem?
:::
:::

## Here

```{r}
#| eval = FALSE

#setwd("your path here")

```

```{r}
#| out.width = "50%"
#install here
library(here)

# here

here::here()

# can use with read.csv
```

## Loading the data

::: callout-note
**Always create an R project before you start**
:::

## Aside: naming conventions

-   Object names are case-sensitive

-   Typing in data to call an object named Data will fail

-   Object names can contain letters, numbers, underscores "\_" and
    periods "."

-   In most cases you should use snake_case to name objects

-   Avoid periods

-   use_an_underscore_between_words

-   Names should be short and descriptive, with descriptive being the
    most important feature

## Janitor

![](images/janitor.PNG){fig-align="center"}

## Loading the data

-   You can download data directly from OSF or Github
    -   https://osf.io/qh9rb/

The faculty dataset contains aggregated data per faculty:

-   faculty: Business, Economics, Political Science, Sociology
-   students: number of students
-   profs: number of profs
-   salary: amount of salary
-   costs: amount of costs dataset entails demographic and
    school-related information on imaginary students, such as

## Load the data

-   CSV

```{r}
library(kableExtra)

fac=read.csv(here::here("slides", "02-R", "datasets", "faculty.csv"))

fac %>% 
  gt()

```

## Load data from OSF

```{r}

# try using the url 


```

## Looking at data

```{r}

fac%>%
  summary()

```

## Looking at data

```{r}
library(skimr)

fac%>%
  skim() %>% 
 gt()
```

## Looking at data

-   Select specific columns

    -   use \$ operator to grab one column

        ```{r}
        #| eval = FALSE
        fac

        ```

```{r}
#| eval = FALSE

fac%>% 
  select(column_name) %>%
  summary() %>% 
 

```

## Looking at data

```{r}

fac # whole dataset

head(fac)
tail(fac)
```

## Looking at data

```{r}
# look at specific variables
table(fac$students)
```

```{r}
# let's try another package
library("janitor")
tabyl(fac$students)
```

# Manipulation Tools

## Manipulating data

-   `dplyr` is organized around verbs that manipulate data frames

-   Isolating data:

    -   select()
    -   filter()
    -   arrange()

## Select

![](select.svg){fig-align="center"}

## PalmerPenguins data

```{r}
#install.packages("titanic") # get titanic data

df = palmerpenguins::penguins

df %>% 
  head() %>%
  knitr::kable()
```

## Select columns

The `select` command from `dplyr` allows you to subset columns matching
strings:

```{r}
select(df, sex, year) %>%
  head() %>% 
  knitr::kable()

```

## Select helpers

![](select_helpers.svg){fig-align="center"}

## Select columns

```{r}

select(df, starts_with("b")) %>%
  head() %>% 
  knitr::kable()


```

# Exercise

-   Alter the code to select everything but the `sex`column

## Select columns

If you wanted it to be a single vector (not a `tibble`), use `pull`:

```{r}
pull(select(df, sex))
```

## Filter

![](images/filter.PNG){fig-align="center"}

## Filter

```{r}
df %>% 
filter(sex=="male", year < 2007) %>% head()
```

Note, no `$` or subsetting is necessary

## Filter

`==` (tests if equal)

`=` (returns error)

```{r, eval=FALSE}
head(filter(df, sex="female", year < 2008))
```

## Filter

You can have multiple logical conditions using the following:

-   `==` : equals to
-   `!` : not/negation
-   `>` / `<`: greater than / less than
-   `>=` or `<=`: greater than or equal to / less than or equal to
-   `&` : AND
-   `|` : OR
-   `is.na(x)`: is NA
-   `!is.na(x)`: is not NA

## Common mistakes

-   Using `=` instead of `==`

```{r}

filter(df, Survived==1)

```

-   Forgetting quotes

```{r, eval=FALSE}

filter(df, Name==John)

filter(df, Name=="John")

```

## Arrange

![](arrange.svg){fig-align="center"}

## Arrange

-   The `arrange` function can reorder rows

-   By default, `arrange` orders in ascending order:

```{r}
arrange(df, Survived) %>%
  head()
```

## Mutate

![](images/mutate.PNG){fig-align="center"}

## Mutate

```{r}
df %>% 
  mutate(spec_island=paste(species,island, sep="_"))

df %>%
  tibble()
```

## Creating conditional (if-else) variables

A general function for creating new variables based on existing
variables is the `ifelse()` function, which "returns a value with the
same shape as test which is filled with elements selected from either
yes or no depending on whether the element of test is `TRUE` or `FALSE`.

```{r}
#| eval: false
#| 
ifelse(test, yes, no)

# test: an object which can be coerced
#to logical mode.
# yes: return values for true elements of test.
# no: return values for false elements of test.
```

## Adding columns

Combined with `ifelse(condition, TRUE, FALSE)`, it can give you:

```{r}

df = mutate(df, 
            ticket_type = ifelse(
              Pclass==1,
              "First Class", ifelse(
              Pclass== 2, "Business Class", 
              "Economy")
            )
)
head(df$money)
```

## Case_when

::: columns
::: {.column width="50%"}
![](images/case_when.PNG){fig-align="center"}
:::

::: {.column width="50%"}
```{r}
df = mutate(df, 
            ticket_type = case_when(
              Pclass==1 ~ "First CLass",
              Pclass==2 ~ "Buiness Class",
              TRUE ~ "Economy"
            ))
head(df$ticket_type)

```
:::
:::

## Exercise

> See if you can use the logical operators to manipulate our penguins
> data, use `%`

-   All of the penguin data from 2007

-   All of the female penguins

-   Get flipper length \> 150

-   Order from smallest to largest flipper

-   Only the flipper length and species columns

# Outline

-   Why R

-   IDE

-   R commands & functions

    -   Tidyverse & the pipe operator

-   Multiple functions

-   Reading in data

-   Manipulating data

-   `Saving R scripts`

## Saving files

```{r}
#| eval = FALSE

write.csv(fac, file="df.csv")

write.table(fac, file="df.txt")


```

## Wrapping up

-   You've learned:

    -   Some basic programming terminology

    -   Specific *R* defaults and issues

    -   Example functions and use cases

-   How do I get started?

    -   Practice!

# Helpful Websites

-   Google!
-   Cheat sheets (https://rstudio.cloud/learn/cheat-sheets)
-   Quick-R: www.statmethods.net
-   R documentation: www.rdocumentation.org
-   Swirl: www.swirlstats.com
-   Stack Overflow: www.stackoverflow.com
-   Learn Statistics with R: https://learningstatisticswithr.com/
